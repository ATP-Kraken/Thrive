// Main menu script of Thrive
GUIBaseFile = "MainMenu.layout";
GUIAnimations = ["thrive.anims"];
RequireCEGUIHooked = true;




// This keeps the GUI always on (no mouse capture is used on the main menu)
o GuiCollection "OnKeeper"{
    l params{
        Enabled = true;
        KeepsGUIOn = true;
    }
}


// Top level window
o GuiCollection "TopLevelMenu"{
    l params{
        Enabled = true;
        AutoTarget = "Background/MainMenuInteractive";
        //AutoAnimateChildren = true;
        //AutoAnimationIn = [[AutoTarget], [PopIn]];
        //AutoAnimationOut = [[AutoTarget], [SinkAway]];
    }
}

// ------------------------------------ //
// This creates the intro video player
o GuiObject "_IntroVideoStarter"{
    s{
        [@Listener="OnInit"]
        bool WriteVersion(GuiObject@ instance){

            LOG_INFO("Starting to play intro video");
            CEGUI::Window@ videoPlayer = instance.GetOwningManager().GetRootWindow().
                 CreateAndAddChild("Thrive/VideoPlayer");

            videoPlayer.SetSize(1.0, 0, 1.0, 0);

            auto@ castedPlayer = cast<CEGUIVideoPlayer>(videoPlayer);

            // Grab the created window as our own
            instance.ConnectElement(videoPlayer);

            if(!instance.IsCEGUIEventHooked()){

                LOG_ERROR("IntroVideoStarter failed to bind to the created video "
                    "player widget");
                return false;
            }

            // Start playback
            castedPlayer.Play("Data/Videos/intro.mp4");

            return true;
        }

        [@Listener="OnClick"]
        bool VideoPlayerClicked(GuiObject@ instance){

             LOG_INFO("VideoPlayer clicked");
             return true;
        }
    @%};
}



// ------------------------------------ //
// Version label
o GuiObject "Background/MainMenuInteractive/VersionLabel"{
    s{
        [@Listener="OnInit"]
        bool WriteVersion(GuiObject@ instance){

            instance.GetTargetWindow().SetText("TODO: ver (" + GetLeviathanVersion() +
                 ")");

            return true;
        }
    @%};
}

// Quit the game //
o GuiObject "Background/MainMenuInteractive/ExitGameButton"{
    s{
        [@Listener="OnClick"]
        bool QuitIt(GuiObject@ instance){
            // Close the game //
            cast<LeviathanApplication>(GetThriveGame()).MarkAsClosing();
            return true;
        }
        @%};
}


